<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="style.css">

    <title>My Cart</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;900&family=Roboto:wght@300&display=swap');
    </style>

    <script src="index.js"></script>

</head>

<body>

    <h1>Products</h1>


    <main>

        <div class="products">

        </div>


        <div class="payment">

            <div class="cart">
                <h2>Cart</h2>

                <table class="product-cart-table">

                    <thead>
                        <tr>
                            <th>Items</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th></th>
                        </tr>    
                    </thead>
                    
                </table>

            </div>




            <div class="paymentSection">

                <h2>Payment</h2>


                <button class="button" onclick="checkout()">Proceed to checkout</button>

            </div>

        </div>

    </main>

    <br><hr><br>

    <footer>

        <a href="https://www.linkedin.com/in/ali-kerem-ata-11149521a/">LinkedIn</a>
        <a href="https://github.com/sabakukhyraa">Github</a>

    </footer>

    <script>

        const cart = []
        const quantityOfIds = []
        const quantityFinder = (theId) => quantityOfIds.filter(unit => (unit == theId))

        function addToCart (itemId) {

            let item = products.filter(obj => (obj.id == itemId))

            cart.push(item[0])
            quantityOfIds.push(itemId)

            const tableLoc = document.querySelector(".product-cart-table")
            const itemLine = document.createElement("tr")
            itemLine.classList.add(`${itemId}`)
            const itemName = document.createElement("td")
            const quantity = document.createElement("td")
            quantity.setAttribute("id", `${itemId}`)
            const price =  document.createElement("td")
            const removeBtn = document.createElement("button")
            removeBtn.classList.add("button")
            removeBtn.setAttribute("onclick", `removeFromCart(${itemId})`)


            if ((quantityFinder(itemId).length) != 1) {
                document.getElementById(`${itemId}`).innerHTML = quantityFinder(itemId).length
            }

            else {
                tableLoc.appendChild(itemLine)
                itemLine.appendChild(itemName)
                itemLine.appendChild(quantity)
                itemLine.appendChild(price)
                itemLine.appendChild(removeBtn)
                itemName.innerHTML = item[0].productName
                quantity.innerHTML = quantityFinder(itemId).length
                price.innerHTML = item[0].unitPrice
                removeBtn.innerHTML = "X"
            }
        }



        function removeFromCart (Id) {  
            
            let indexOfItem = quantityOfIds.indexOf(Id)
            


            if ((quantityFinder(Id).length) == 1) {
                const elem = document.getElementById(`${Id}`).parentElement
                elem.remove()
                cart.splice(indexOfItem, 1)
                quantityOfIds.splice(indexOfItem, 1)
                console.log("ananke")
            }


            if ((quantityFinder(Id).length) > 1) {
                cart.splice(indexOfItem, 1)
                quantityOfIds.splice(indexOfItem, 1)
                document.getElementById(`${Id}`).innerHTML = quantityFinder(Id).length
            }
        }



        function infoPrinter (elem) {

            for (let i = 0; i < elem.length; i++) {

                const node = document.createElement("div")
                const name = document.createElement("h4")
                const price = document.createElement("h5")
                const pic = document.createElement("img")
                const add = document.createElement("button")

                document.querySelector(".products").appendChild(node)

                node.classList.add("product")

                node.appendChild(pic)
                node.appendChild(name)
                
                node.appendChild(price)
                node.appendChild(add)

                let att = document.createAttribute("onclick")
                att.value = `addToCart(${elem[i].id})`
                add.setAttributeNode(att)
                add.innerHTML = "Add to Cart"
                add.classList.add("button")

                let att2 = document.createAttribute("src")
                att2.value = elem[i].img_src
                pic.setAttributeNode(att2)

                let att3 = document.createAttribute("alt")
                att3.value = elem[i].productName
                pic.setAttributeNode(att3)

                document.querySelector(`.product:nth-of-type(${i + 1})>h4`).innerHTML = elem[i].productName
                document.querySelector(`.product:nth-of-type(${i + 1})>h5`).innerHTML = `${elem[i].unitPrice} TL`
            }
        }



        function checkout() {

        }


        infoPrinter(products)

    </script>

    
</body>

</html>